/*! cornerstone - v0.10.5 - 2017-04-06 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
"undefined"==typeof cornerstone&&(cornerstone={internal:{},rendering:{}}),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=a.internal.getTransform(d);return e.invert(),e.transformPoint(c.x,c.y)}a.canvasToPixel=b}(cornerstone),function(a){"use strict";function b(b){if(void 0===b)throw"disable: element element must not be undefined";for(var c=a.getEnabledElements(),d=0;d<c.length;d++)if(c[d].element===b){var e={element:b};return $(b).trigger("CornerstoneElementDisabled",e),c[d].element.removeChild(c[d].canvas),c[d].canvas=void 0,void c.splice(d,1)}}a.disable=b}(cornerstone),function(a,b){"use strict";function c(c,d,e){if(void 0===c)throw"displayImage: parameter element cannot be undefined";if(void 0===d)throw"displayImage: parameter image cannot be undefined";var f=b.getEnabledElement(c);if(f.image=d,void 0===f.viewport&&(f.viewport=b.internal.getDefaultViewport(f.canvas,d)),e)for(var g in e)null!==e[g]&&(f.viewport[g]=e[g]);var h,i=new Date;if(void 0!==f.lastImageTimeStamp){var j=i.getTime()-f.lastImageTimeStamp;h=(1e3/j).toFixed()}f.lastImageTimeStamp=i.getTime();var k={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,frameRate:h};a(f.element).trigger("CornerstoneNewImage",k),b.updateImage(c)}b.displayImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);if(void 0===c.image)throw"draw: image has not been loaded yet";b.drawImage(c)}b.draw=c}($,cornerstone),function(a,b){"use strict";function c(){for(var a=b.getEnabledElements(),c=0;c<a.length;c++){var d=a[c];d.invalid===!0&&b.drawImage(d,!0)}}b.drawInvalidated=c}($,cornerstone),function(a){"use strict";function b(b,c){function d(){if(void 0!==f.canvas){if(f.needsRedraw&&void 0!==f.image){var b=new Date;f.image.render(f,f.invalid);var c=f.canvas.getContext("2d"),e=new Date,g=e-b,h={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,canvasContext:c,renderTimeInMs:g};f.invalid=!1,f.needsRedraw=!1,$(f.element).trigger("CornerstoneImageRendered",h)}a.requestAnimationFrame(d)}}if(void 0===b)throw"enable: parameter element cannot be undefined";c&&c.renderer&&"webgl"===c.renderer.toLowerCase()&&(a.webGL.renderer.isWebGLAvailable()?(console.log("Using WebGL rendering path"),a.webGL.renderer.initRenderer(),c.renderer="webgl"):(console.error("WebGL not available, falling back to Canvas renderer"),delete c.renderer));var e=document.createElement("canvas");b.appendChild(e);var f={element:b,canvas:e,image:void 0,invalid:!1,needsRedraw:!0,options:c,data:{}};return a.addEnabledElement(f),a.resize(b,!0),d(),b}a.enable=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);return d.data.hasOwnProperty(c)===!1&&(d.data[c]={}),d.data[c]}function c(b,c){var d=a.getEnabledElement(b);delete d.data[c]}a.getElementData=b,a.removeElementData=c}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"getEnabledElement: parameter element must not be undefined";for(var b=0;b<f.length;b++)if(f[b].element==a)return f[b];throw"element not enabled"}function c(a){if(void 0===a)throw"getEnabledElement: enabledElement element must not be undefined";f.push(a)}function d(a){var b=[];return f.forEach(function(c){c.image&&c.image.imageId===a&&b.push(c)}),b}function e(){return f}var f=[];a.getEnabledElement=b,a.addEnabledElement=c,a.getEnabledElementsByImageId=d,a.getEnabledElements=e}(cornerstone),function(a){"use strict";function b(a){return 0===a.viewport.rotation||180===a.viewport.rotation?{width:a.image.width,height:a.image.height}:{width:a.image.height,height:a.image.width}}function c(c){var d=a.getEnabledElement(c),e=b(d),f=d.canvas.height/e.height,g=d.canvas.width/e.width;f>g?d.viewport.scale=g:d.viewport.scale=f,d.viewport.translation.x=0,d.viewport.translation.y=0,a.updateImage(c)}a.fitToWindow=c}(cornerstone),function(a,b){"use strict";function c(a,c){var d=b.getEnabledElement(a),e=b.internal.getDefaultViewport(d.canvas,c);return e}b.getDefaultViewportForImage=c}($,cornerstone),function(a,b){"use strict";function c(a){var c=b.getEnabledElement(a);return c.image}b.getImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f){var g=a.getStoredPixels(b,c,d,e,f),h=a.getEnabledElement(b),i=a.internal.getModalityLUT(h.image.slope,h.image.intercept,h.viewport.modalityLUT),j=g.map(i);return j}a.getPixels=b}(cornerstone),function(a){"use strict";function b(b,c,d,e,f){if(void 0===b)throw"getStoredPixels: parameter element must not be undefined";c=Math.round(c),d=Math.round(d);for(var g=a.getEnabledElement(b),h=[],i=0,j=g.image.getPixelData(),k=0;f>k;k++)for(var l=0;e>l;l++){var m=(k+d)*g.image.columns+(l+c);h[i++]=j[m]}return h}a.getStoredPixels=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=c.viewport;return void 0!==d?{scale:d.scale,translation:{x:d.translation.x,y:d.translation.y},voi:{windowWidth:d.voi.windowWidth,windowCenter:d.voi.windowCenter},invert:d.invert,pixelReplication:d.pixelReplication,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip,modalityLUT:d.modalityLUT,voiLUT:d.voiLUT}:void 0}a.getViewport=b}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";m=a,c()}function c(){function b(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(m>=n)){for(l.sort(b);n>m;){var c=l[l.length-1],d=c.imageId;f(d),$(a).trigger("CornerstoneImageCachePromiseRemoved",{imageId:d})}var e=a.imageCache.getCacheInfo();$(a).trigger("CornerstoneImageCacheFull",e)}}function d(a,b){if(void 0===a)throw"getImagePromise: imageId must not be undefined";if(void 0===b)throw"getImagePromise: imagePromise must not be undefined";if(k.hasOwnProperty(a)===!0)throw"putImagePromise: imageId already in cache";var d={loaded:!1,imageId:a,sharedCacheKey:void 0,imagePromise:b,timeStamp:new Date,sizeInBytes:0};k[a]=d,l.push(d),b.then(function(a){if(d.loaded=!0,d.image=a,void 0===a.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===a.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";d.sizeInBytes=a.sizeInBytes,n+=d.sizeInBytes,d.sharedCacheKey=a.sharedCacheKey,c()})}function e(a){if(void 0===a)throw"getImagePromise: imageId must not be undefined";var b=k[a];if(void 0!==b)return b.timeStamp=new Date,b.imagePromise}function f(a){if(void 0===a)throw"removeImagePromise: imageId must not be undefined";var b=k[a];if(void 0===b)throw"removeImagePromise: imageId must not be undefined";return b.imagePromise.reject(),l.splice(l.indexOf(b),1),n-=b.sizeInBytes,h(b.imagePromise,b.imageId),delete k[a],b.imagePromise}function g(){return{maximumSizeInBytes:m,cacheSizeInBytes:n,numberOfImagesCached:l.length}}function h(a,b){a.then(function(a){a.decache&&a.decache()}).always(function(){delete k[b]})}function i(){for(;l.length>0;){var a=l[0];f(a.imageId)}}function j(a,b){var c=k[a];c&&c.imagePromise.then(function(a){var c=b-a.sizeInBytes;a.sizeInBytes=b,n+=c})}var k={},l=[],m=1073741824,n=0;a.imageCache={putImagePromise:d,getImagePromise:e,removeImagePromise:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:i,cachedImages:l,imageCache:k,changeImageIdCacheSize:j}}(cornerstone),function(a,b){"use strict";function c(c,d){var e,f=c.indexOf(":"),g=c.substring(0,f),j=i[g];return void 0===j||null===j?void 0!==h?e=h(c):void 0:(e=j(c,d),e.then(function(c){a(b).trigger("CornerstoneImageLoaded",{image:c})}),e)}function d(a,d){if(void 0===a)throw"loadImage: parameter imageId must not be undefined";var e=b.imageCache.getImagePromise(a);if(void 0!==e)return e;if(e=c(a,d),void 0===e)throw"loadImage: no image loader for imageId";return e}function e(a,d){if(void 0===a)throw"loadAndCacheImage: parameter imageId must not be undefined";var e=b.imageCache.getImagePromise(a);if(void 0!==e)return e;if(e=c(a,d),void 0===e)throw"loadAndCacheImage: no image loader for imageId";return b.imageCache.putImagePromise(a,e),e}function f(a,b){i[a]=b}function g(a){var b=h;return h=a,b}var h,i={};b.loadImage=d,b.loadAndCacheImage=e,b.registerImageLoader=f,b.registerUnknownImageLoader=g}($,cornerstone),function(a){"use strict";function b(b,c){var d=new a.internal.Transform;d.translate(b.canvas.width/2,b.canvas.height/2);var e=b.viewport.rotation;0!==e&&d.rotate(e*Math.PI/180);var f=b.viewport.scale,g=b.viewport.scale;return b.image.rowPixelSpacing<b.image.columnPixelSpacing?f*=b.image.columnPixelSpacing/b.image.rowPixelSpacing:b.image.columnPixelSpacing<b.image.rowPixelSpacing&&(g*=b.image.rowPixelSpacing/b.image.columnPixelSpacing),d.scale(f,g),0!==e&&d.rotate(-e*Math.PI/180),d.translate(b.viewport.translation.x,b.viewport.translation.y),0!==e&&d.rotate(e*Math.PI/180),void 0!==c&&d.scale(c,c),b.viewport.hflip&&d.scale(-1,1),b.viewport.vflip&&d.scale(1,-1),d.translate(-b.image.width/2,-b.image.height/2),d}a.internal.calculateTransform=b}(cornerstone),function(a,b){"use strict";function c(a,b){a.needsRedraw=!0,b&&(a.invalid=!0)}b.internal.drawImage=c,b.drawImage=c}($,cornerstone),function(a){"use strict";function b(b,c,d,e,f,g){void 0===b.lut&&(b.lut=new Int16Array(b.maxPixelValue-Math.min(b.minPixelValue,0)+1));var h=b.lut,i=b.maxPixelValue,j=b.minPixelValue,k=a.internal.getModalityLUT(b.slope,b.intercept,f),l=a.internal.getVOILUT(c,d,g),m=0;0>j&&(m=j);var n,o,p,q;for(n=b.minPixelValue;i>=n;n++)o=k(n),p=l(o),q=Math.min(Math.max(p,0),255),e?h[n+-m]=Math.round(255-q):h[n+-m]=Math.round(q);return h}function c(a,c,d,e,f,g){if(f||g)return b(a,c,d,e,f,g);void 0===a.lut&&(a.lut=new Int16Array(a.maxPixelValue-Math.min(a.minPixelValue,0)+1));var h,i,j,k,l=a.lut,m=a.maxPixelValue,n=a.minPixelValue,o=a.slope,p=a.intercept,q=c,r=d,s=0;if(0>n&&(s=n),e===!0)for(k=a.minPixelValue;m>=k;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(255-j);else for(k=a.minPixelValue;m>=k;k++)h=k*o+p,i=255*((h-r)/q+.5),j=Math.min(Math.max(i,0),255),l[k+-s]=Math.round(j)}a.internal.generateLutNew=b,a.internal.generateLut=c,a.generateLutNew=b,a.generateLut=c}(cornerstone),function(a){"use strict";function b(a,b){if(void 0===a)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===b)throw"getDefaultViewport: parameter image must not be undefined";var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:b.windowWidth,windowCenter:b.windowCenter},invert:b.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:b.modalityLUT,voiLUT:b.voiLUT},d=a.height/b.rows,e=a.width/b.columns;return d>e?c.scale=e:c.scale=d,c}a.internal.getDefaultViewport=b,a.getDefaultViewport=b}(cornerstone),function(a){"use strict";function b(b){var c=a.internal.calculateTransform(b);return c}a.internal.getTransform=b}(cornerstone),function(a,b){"use strict";b.drawImage=b.internal.drawImage,b.generateLut=b.internal.generateLut,b.storedPixelDataToCanvasImageData=b.internal.storedPixelDataToCanvasImageData,b.storedColorPixelDataToCanvasImageData=b.internal.storedColorPixelDataToCanvasImageData}($,cornerstone),function(a){"use strict";function b(a,b){var c=a,d=b;return function(a){return a*c+d}}function c(a){var b=a.lut[0],c=a.lut[a.lut.length-1],d=a.firstValueMapped+a.lut.length;return function(e){return e<a.firstValueMapped?b:e>=d?c:a.lut[e]}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getModalityLUT=d}(cornerstone),function(a){"use strict";function b(a){window.setTimeout(a,1e3/60)}function c(a){return window.requestAnimationFrame(a)||window.webkitRequestAnimationFrame(a)||window.mozRequestAnimationFrame(a)||window.oRequestAnimationFrame(a)||window.msRequestAnimationFrame(a)||b(a)}a.requestAnimationFrame=c}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.minPixelValue,e=0,f=0,g=a.width*a.height*4,h=a.getPixelData(),i=b,j=c;!function(){if(0>d)for(;g>f;)j[e++]=i[h[f++]+-d],j[e++]=i[h[f++]+-d],j[e]=i[h[f]+-d],f+=2,e+=2;else for(;g>f;)j[e++]=i[h[f++]],j[e++]=i[h[f++]],j[e]=i[h[f]],f+=2,e+=2}()}a.internal.storedColorPixelDataToCanvasImageData=b,a.storedColorPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.getPixelData(),e=a.minPixelValue,f=3,g=0,h=d.length,i=d,j=b,k=c;!function(){if(0>e)for(;h>g;)k[f]=j[i[g++]+-e],f+=4;else for(;h>g;)k[f]=j[i[g++]],f+=4}()}a.internal.storedPixelDataToCanvasImageData=b,a.storedPixelDataToCanvasImageData=b}(cornerstone),function(a){"use strict";function b(){this.reset()}b.prototype.reset=function(){this.m=[1,0,0,1,0,0]},b.prototype.clone=function(){var a=new b;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a},b.prototype.multiply=function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},b.prototype.translate=function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},b.prototype.scale=function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},b.prototype.transformPoint=function(a,b){var c=a,d=b;return a=c*this.m[0]+d*this.m[2]+this.m[4],b=c*this.m[1]+d*this.m[3]+this.m[5],{x:a,y:b}},a.internal.Transform=b}(cornerstone),function(a){"use strict";function b(a,b){return function(c){return 255*((c-b)/a+.5)}}function c(a){var b=a.numBitsPerEntry-8,c=a.lut[0]>>b,d=a.lut[a.lut.length-1]>>b,e=a.firstValueMapped+a.lut.length-1;return function(f){return f<a.firstValueMapped?c:f>=e?d:a.lut[f-a.firstValueMapped]>>b}}function d(a,d,e){return e?c(e):b(a,d)}a.internal.getVOILUT=d}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b);c.invalid=!0,c.needsRedraw=!0;var d={element:b};$(c.element).trigger("CornerstoneInvalidated",d)}a.invalidate=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElementsByImageId(b);c.forEach(function(b){a.drawImage(b,!0)})}a.invalidateImageId=b}(cornerstone),function(a,b){"use strict";function c(a,b){b=b||0;for(var c=0;c<f.length&&!(f[c].priority<=b);c++);f.splice(c,0,{priority:b,provider:a})}function d(a){for(var b=0;b<f.length;b++)if(f[b].provider===a)return void f.splice(b,1)}function e(a,b){for(var c=0;c<f.length;c++){var d;if(d=f[c].provider(a,b),void 0!==d)return d}}var f=[];b.metaData={addProvider:c,removeProvider:d,get:e}}($,cornerstone),function(a){"use strict";function b(b,c,d){var e=a.getEnabledElement(b);if(void 0===e.image)throw"image has not been loaded yet";var f=(e.image,b.getBoundingClientRect()),g=c-f.left-window.pageXOffset,h=d-f.top-window.pageYOffset,i={x:g,y:h},j=a.internal.getTransform(e);return j.invert(),j.transformPoint(i.x,i.y)}a.pageToPixel=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b),e=a.internal.getTransform(d);return e.transformPoint(c.x,c.y)}a.pixelToCanvas=b}(cornerstone),function(a){"use strict";function b(a,b){var c=a.renderingTools.colorRenderCanvas;c.width=b.width,c.height=b.height;var d=c.getContext("2d");d.fillStyle="white",d.fillRect(0,0,c.width,c.height);var e=d.getImageData(0,0,b.width,b.height);a.renderingTools.colorRenderCanvasContext=d,a.renderingTools.colorRenderCanvasData=e}function c(b,c){return void 0!==b.lut&&b.lut.windowCenter===c.voi.windowCenter&&b.lut.windowWidth===c.voi.windowWidth&&b.lut.invert===c.invert?b.lut:(a.generateLut(b,c.voi.windowWidth,c.voi.windowCenter,c.invert),b.lut.windowWidth=c.voi.windowWidth,b.lut.windowCenter=c.voi.windowCenter,b.lut.invert=c.invert,b.lut)}function d(a,b){var c=a.renderingTools.lastRenderedImageId,d=a.renderingTools.lastRenderedViewport;return b.imageId!==c||d.windowCenter!==a.viewport.voi.windowCenter||d.windowWidth!==a.viewport.voi.windowWidth||d.invert!==a.viewport.invert||d.rotation!==a.viewport.rotation||d.hflip!==a.viewport.hflip||d.vflip!==a.viewport.vflip}function e(e,f,g){e.renderingTools.colorRenderCanvas||(e.renderingTools.colorRenderCanvas=document.createElement("canvas"));var h=e.renderingTools.colorRenderCanvas;if(255===e.viewport.voi.windowWidth&&128===e.viewport.voi.windowCenter&&e.viewport.invert===!1&&f.getCanvas&&f.getCanvas())return f.getCanvas();if(d(e,f)===!1&&g!==!0)return h;h.width===f.width&&h.height===f.height||b(e,f);var i=c(f,e.viewport),j=e.renderingTools.colorRenderCanvasData,k=e.renderingTools.colorRenderCanvasContext;return a.storedColorPixelDataToCanvasImageData(f,i,j.data),k.putImageData(j,0,0),h}function f(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var f=b.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0),f.fillStyle="black",f.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1):(f.imageSmoothingEnabled=!0,f.mozImageSmoothingEnabled=!0),f.save(),a.setToPixelCoordinateSystem(b,f),b.renderingTools||(b.renderingTools={});var g;g=b.options&&b.options.renderer&&"webgl"===b.options.renderer.toLowerCase()?a.webGL.renderer.render(b):e(b,d,c),f.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),f.restore(),b.renderingTools.lastRenderedImageId=d.imageId;var h={};h.windowCenter=b.viewport.voi.windowCenter,h.windowWidth=b.viewport.voi.windowWidth,h.invert=b.viewport.invert,h.rotation=b.viewport.rotation,h.hflip=b.viewport.hflip,h.vflip=b.viewport.vflip,b.renderingTools.lastRenderedViewport=h}a.rendering.colorImage=f,a.renderColorImage=f}(cornerstone),function(a){"use strict";function b(a,b){var c=a.renderingTools.grayscaleRenderCanvas;c.width=b.width,c.height=b.height;var d=c.getContext("2d");d.fillStyle="white",d.fillRect(0,0,c.width,c.height);var e=d.getImageData(0,0,b.width,b.height);a.renderingTools.grayscaleRenderCanvasContext=d,a.renderingTools.grayscaleRenderCanvasData=e}function c(a,b){return a||b?a&&b?a.id===b.id:!1:!0}function d(b,d,e){return void 0!==b.lut&&b.lut.windowCenter===d.voi.windowCenter&&b.lut.windowWidth===d.voi.windowWidth&&c(b.lut.modalityLUT,d.modalityLUT)&&c(b.lut.voiLUT,d.voiLUT)&&b.lut.invert===d.invert&&e!==!0?b.lut:(a.generateLut(b,d.voi.windowWidth,d.voi.windowCenter,d.invert,d.modalityLUT,d.voiLUT),b.lut.windowWidth=d.voi.windowWidth,b.lut.windowCenter=d.voi.windowCenter,b.lut.invert=d.invert,b.lut.voiLUT=d.voiLUT,b.lut.modalityLUT=d.modalityLUT,b.lut)}function e(a,b){var c=a.renderingTools.lastRenderedImageId,d=a.renderingTools.lastRenderedViewport;return b.imageId!==c||d.windowCenter!==a.viewport.voi.windowCenter||d.windowWidth!==a.viewport.voi.windowWidth||d.invert!==a.viewport.invert||d.rotation!==a.viewport.rotation||d.hflip!==a.viewport.hflip||d.vflip!==a.viewport.vflip||d.modalityLUT!==a.viewport.modalityLUT||d.voiLUT!==a.viewport.voiLUT}function f(c,f,g){c.renderingTools.grayscaleRenderCanvas||(c.renderingTools.grayscaleRenderCanvas=document.createElement("canvas"));var h=c.renderingTools.grayscaleRenderCanvas;if(e(c,f)===!1&&g!==!0)return h;h.width===f.width&&h.height===f.height||b(c,f);var i=d(f,c.viewport,g),j=c.renderingTools.grayscaleRenderCanvasData,k=c.renderingTools.grayscaleRenderCanvasContext;return a.storedPixelDataToCanvasImageData(f,i,j.data),k.putImageData(j,0,0),h}function g(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.renderingTools||(b.renderingTools={});var g;g=b.options&&b.options.renderer&&"webgl"===b.options.renderer.toLowerCase()?a.webGL.renderer.render(b):f(b,d,c),e.drawImage(g,0,0,d.width,d.height,0,0,d.width,d.height),b.renderingTools.lastRenderedImageId=d.imageId;var h={};h.windowCenter=b.viewport.voi.windowCenter,h.windowWidth=b.viewport.voi.windowWidth,h.invert=b.viewport.invert,h.rotation=b.viewport.rotation,h.hflip=b.viewport.hflip,h.vflip=b.viewport.vflip,h.modalityLUT=b.viewport.modalityLUT,h.voiLUT=b.viewport.voiLUT,b.renderingTools.lastRenderedViewport=h}a.rendering.grayscaleImage=g,a.renderGrayscaleImage=g}(cornerstone),function(a){"use strict";function b(b,c){if(void 0===b)throw"drawImage: enabledElement parameter must not be undefined";var d=b.image;if(void 0===d)throw"drawImage: image must be loaded before it can be drawn";var e=b.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.fillStyle="black",e.fillRect(0,0,b.canvas.width,b.canvas.height),b.viewport.pixelReplication===!0?(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1):(e.imageSmoothingEnabled=!0,e.mozImageSmoothingEnabled=!0),a.setToPixelCoordinateSystem(b,e),b.viewport.voi.windowWidth===b.image.windowWidth&&b.viewport.voi.windowCenter===b.image.windowCenter&&b.viewport.invert===!1?e.drawImage(d.getImage(),0,0,d.width,d.height,0,0,d.width,d.height):a.renderColorImage(b,c)}a.rendering.webImage=b,a.renderWebImage=b}(cornerstone),function(a){"use strict";function b(b){var c=a.getEnabledElement(b),d=a.internal.getDefaultViewport(c.canvas,c.image);c.viewport=d,a.updateImage(b)}a.reset=b}(cornerstone),function(a){"use strict";function b(a,b){b.width=a.clientWidth,b.height=a.clientHeight,b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px"}function c(c,d){var e=a.getEnabledElement(c);b(c,e.canvas);var f={element:c};$(c).trigger("CornerstoneElementResized",f),void 0!==e.image&&(d===!0?a.fitToWindow(c):a.updateImage(c))}a.resize=c}(cornerstone),function(a){"use strict";function b(b,c,d){if(void 0===b)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===c)throw"setToPixelCoordinateSystem: parameter context must not be undefined";var e=a.internal.calculateTransform(b,d);c.setTransform(e.m[0],e.m[1],e.m[2],e.m[3],e.m[4],e.m[5])}a.setToPixelCoordinateSystem=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);d.viewport.scale=c.scale,d.viewport.translation.x=c.translation.x,d.viewport.translation.y=c.translation.y,d.viewport.voi.windowWidth=c.voi.windowWidth,d.viewport.voi.windowCenter=c.voi.windowCenter,d.viewport.invert=c.invert,d.viewport.pixelReplication=c.pixelReplication,d.viewport.rotation=c.rotation,d.viewport.hflip=c.hflip,d.viewport.vflip=c.vflip,d.viewport.modalityLUT=c.modalityLUT,d.viewport.voiLUT=c.voiLUT,d.viewport.voi.windowWidth<1e-6&&(d.viewport.voi.windowWidth=1e-6),d.viewport.scale<1e-4&&(d.viewport.scale=.25),360!==d.viewport.rotation&&-360!==d.viewport.rotation||(d.viewport.rotation=0),a.updateImage(b)}a.setViewport=b}(cornerstone),function(a){"use strict";function b(b,c){var d=a.getEnabledElement(b);if(void 0===d.image)throw"updateImage: image has not been loaded yet";a.drawImage(d,c)}a.updateImage=b}(cornerstone),function(a){"use strict";function b(a,b,c){var d=a.createShader(c);a.shaderSource(d,b),a.compileShader(d);var e=a.getShaderParameter(d,a.COMPILE_STATUS);if(!e&&!a.isContextLost()){var f=a.getShaderInfoLog(d);console.error("Could not compile shader:\n"+f)}return d}function c(a,b,c){var d=a.createProgram();a.attachShader(d,b),a.attachShader(d,c),a.linkProgram(d);var e=a.getProgramParameter(d,a.LINK_STATUS);if(!e&&!a.isContextLost()){var f=a.getProgramInfoLog(d);console.error("WebGL program filed to link:\n"+f)}return d}function d(a,d,e){var f=b(a,d,a.VERTEX_SHADER),g=b(a,e,a.FRAGMENT_SHADER);return c(a,f,g)}a.webGL||(a.webGL={}),a.webGL.createProgramFromString=d}(cornerstone),function(a){"use strict";function b(){return t}function c(){for(var b in a.webGL.shaders){var c=a.webGL.shaders[b];c.attributes={},c.uniforms={},c.vert=a.webGL.vertexShader,c.program=a.webGL.createProgramFromString(q,c.vert,c.frag),c.attributes.texCoordLocation=q.getAttribLocation(c.program,"a_texCoord"),q.enableVertexAttribArray(c.attributes.texCoordLocation),c.attributes.positionLocation=q.getAttribLocation(c.program,"a_position"),q.enableVertexAttribArray(c.attributes.positionLocation),c.uniforms.resolutionLocation=q.getUniformLocation(c.program,"u_resolution")}}function d(){a.webGL.isWebGLInitialized!==!0&&h(t)&&(m(),c(),a.webGL.isWebGLInitialized=!0)}function e(a,b,c){a.bufferData(a.ARRAY_BUFFER,new Float32Array([b,c,0,c,b,0,0,0]),a.STATIC_DRAW)}function f(a){a.preventDefault(),console.warn("WebGL Context Lost!")}function g(b){b.preventDefault(),a.webGL.isWebGLInitialized=!1,a.webGL.textureCache.purgeCache(),d()}function h(b){q=null;try{var c={preserveDrawingBuffer:!0};a.webGL.debug===!0&&WebGLDebugUtils&&(t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t)),q=b.getContext("webgl",c)||b.getContext("experimental-webgl",c),b.removeEventListener("webglcontextlost",f,!1),b.addEventListener("webglcontextlost",f,!1),b.removeEventListener("webglcontextrestored",g,!1),b.addEventListener("webglcontextrestored",g,!1)}catch(d){throw"Error creating WebGL context"}return q||(console.error("Unable to initialize WebGL. Your browser may not support it."),q=null),q}function i(a){if(a.color)return"rgb";var b="int";return a.minPixelValue>=0&&(b="u"+b),b+=a.maxPixelValue>255?"16":"8"}function j(b){var c=i(b);if(a.webGL.shaders.hasOwnProperty(c))return a.webGL.shaders[c];var d=a.webGL.shaders.rgb;return d}function k(b){var c=a.webGL.textureCache.getImageTexture(b.imageId);return c||(c=l(b),a.webGL.textureCache.putImageTexture(b,c)),c.texture}function l(b){var c={uint8:q.LUMINANCE,int8:q.LUMINANCE_ALPHA,uint16:q.LUMINANCE_ALPHA,int16:q.RGB,rgb:q.RGB},d={int8:1,uint16:2,int16:3,rgb:3},e=i(b),f=c[e],g=q.createTexture();q.bindTexture(q.TEXTURE_2D,g),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.pixelStorei(q.UNPACK_ALIGNMENT,1);var h=a.webGL.dataUtilities[e].storedPixelDataToImageData(b,b.width,b.height);q.texImage2D(q.TEXTURE_2D,0,f,b.width,b.height,0,f,q.UNSIGNED_BYTE,h);var j=b.width*b.height*d[e],k={texture:g,sizeInBytes:j};return k}function m(){s=q.createBuffer(),q.bindBuffer(q.ARRAY_BUFFER,s),q.bufferData(q.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),q.STATIC_DRAW),r=q.createBuffer(),q.bindBuffer(q.ARRAY_BUFFER,r),q.bufferData(q.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),q.STATIC_DRAW)}function n(a,b,c,d,f){q.clearColor(1,0,0,1),q.viewport(0,0,d,f),q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT),q.useProgram(a.program),q.bindBuffer(q.ARRAY_BUFFER,r),q.vertexAttribPointer(a.attributes.texCoordLocation,2,q.FLOAT,!1,0,0),q.bindBuffer(q.ARRAY_BUFFER,s),q.vertexAttribPointer(a.attributes.positionLocation,2,q.FLOAT,!1,0,0);for(var g in b){var h=q.getUniformLocation(a.program,g);if(!h)throw"Could not access location for uniform: "+g;var i=b[g],j=i.type,k=i.value;"i"==j?q.uniform1i(h,k):"f"==j?q.uniform1f(h,k):"2f"==j&&q.uniform2f(h,k[0],k[1])}e(q,d,f),q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,c),q.drawArrays(q.TRIANGLE_STRIP,0,4)}function o(a){var b=a.image;t.width=b.width,t.height=b.height;var c=a.viewport,d=j(b),e=k(b),f={u_resolution:{type:"2f",value:[b.width,b.height]},wc:{type:"f",value:c.voi.windowCenter},ww:{type:"f",value:c.voi.windowWidth},slope:{type:"f",value:b.slope},intercept:{type:"f",value:b.intercept},invert:{type:"i",value:c.invert?1:0}};return n(d,f,e,b.width,b.height),t}function p(){var a={failIfMajorPerformanceCaveat:!0};try{var b=document.createElement("canvas");return!!window.WebGLRenderingContext&&(b.getContext("webgl",a)||b.getContext("experimental-webgl",a))}catch(c){return!1}}a.webGL||(a.webGL={});var q,r,s,t=document.createElement("canvas");a.webGL.isWebGLInitialized=!1,a.webGL.renderer={render:o,initRenderer:d,getRenderCanvas:b,isWebGLAvailable:p}}(cornerstone),function(a){"use strict";function b(a){for(var b=a.getPixelData(),c=3,d=new Uint8Array(a.width*a.height*c),e=0,f=0;f<b.length;f++){var g=Math.abs(b[f]);d[e++]=parseInt(255&g,10),d[e++]=parseInt(g>>8,10),d[e++]=b[f]<0?0:1}return d}a.webGL||(a.webGL={}),a.webGL.shaders||(a.webGL.shaders={}),a.webGL.dataUtilities||(a.webGL.dataUtilities={});var c={};a.webGL.dataUtilities.int16={storedPixelDataToImageData:b},c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",a.webGL.shaders.int16=c}(cornerstone),function(a){"use strict";function b(a){for(var b=a.getPixelData(),c=2,d=new Uint8Array(a.width*a.height*c),e=0,f=0;f<b.length;f++)d[e++]=parseInt(b[f],10),d[e++]=b[f]<0?0:1;return d}a.webGL||(a.webGL={}),a.webGL.shaders||(a.webGL.shaders={}),a.webGL.dataUtilities||(a.webGL.dataUtilities={});var c={};a.webGL.dataUtilities.int8={storedPixelDataToImageData:b},c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",a.webGL.shaders.int8=c}(cornerstone),function(a){"use strict";function b(a){var b=a.minPixelValue,c=0,d=0,e=a.width*a.height*4,f=a.width*a.height*3,g=a.getPixelData(),h=new Uint8Array(f);if(0>b)for(;e>d;)h[c++]=g[d++]+-b,h[c++]=g[d++]+-b,h[c++]=g[d++]+-b,d+=1;else for(;e>d;)h[c++]=g[d++],h[c++]=g[d++],h[c++]=g[d++],d+=1;return h}a.webGL||(a.webGL={}),a.webGL.shaders||(a.webGL.shaders={}),a.webGL.dataUtilities||(a.webGL.dataUtilities={});var c={};a.webGL.dataUtilities.rgb={storedPixelDataToImageData:b},c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}",a.webGL.shaders.rgb=c}(cornerstone),function(a){"use strict";function b(a){for(var b=a.getPixelData(),c=2,d=new Uint8Array(a.width*a.height*c),e=0,f=0;f<b.length;f++){var g=b[f];d[e++]=parseInt(255&g,10),d[e++]=parseInt(g>>8,10)}return d}a.webGL||(a.webGL={}),a.webGL.shaders||(a.webGL.shaders={}),a.webGL.dataUtilities||(a.webGL.dataUtilities={});var c={};
a.webGL.dataUtilities.uint16={storedPixelDataToImageData:b},c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",a.webGL.shaders.uint16=c}(cornerstone),function(a){"use strict";function b(a){for(var b=a.getPixelData(),c=new Uint8Array(b.length),d=0;d<b.length;d++)c[d]=parseInt(b[d],10);return c}a.webGL||(a.webGL={}),a.webGL.shaders||(a.webGL.shaders={}),a.webGL.dataUtilities||(a.webGL.dataUtilities={});var c={};a.webGL.dataUtilities.uint8={storedPixelDataToImageData:b},c.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}",a.webGL.shaders.uint8=c}(cornerstone),function(a){"use strict";function b(a){if(void 0===a)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===a.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";k=a,c()}function c(){function b(a,b){return a.timeStamp>b.timeStamp?-1:a.timeStamp<b.timeStamp?1:0}if(!(k>=l)){for(j.sort(b);l>k;){var c=j[j.length-1];l-=c.sizeInBytes,delete i[c.imageId],j.pop(),$(a).trigger("CornerstoneWebGLTextureRemoved",{imageId:c.imageId})}var d=a.imageCache.getCacheInfo();console.log("CornerstoneWebGLTextureCacheFull"),$(a).trigger("CornerstoneWebGLTextureCacheFull",d)}}function d(a,b){var d=a.imageId;if(void 0===a)throw"putImageTexture: image must not be undefined";if(void 0===d)throw"putImageTexture: imageId must not be undefined";if(void 0===b)throw"putImageTexture: imageTexture must not be undefined";if(i.hasOwnProperty(d)===!0)throw"putImageTexture: imageId already in cache";var e={imageId:d,imageTexture:b,timeStamp:new Date,sizeInBytes:b.sizeInBytes};if(i[d]=e,j.push(e),void 0===b.sizeInBytes)throw"putImageTexture: imageTexture does not have sizeInBytes property or";if(void 0===b.sizeInBytes.toFixed)throw"putImageTexture: imageTexture.sizeInBytes is not a number";l+=e.sizeInBytes,c()}function e(a){if(void 0===a)throw"getImageTexture: imageId must not be undefined";var b=i[a];if(void 0!==b)return b.timeStamp=new Date,b.imageTexture}function f(a){if(void 0===a)throw"removeImageTexture: imageId must not be undefined";var b=i[a];if(void 0===b)throw"removeImageTexture: imageId must not be undefined";return j.splice(j.indexOf(b),1),l-=b.sizeInBytes,delete i[a],b.imageTexture}function g(){return{maximumSizeInBytes:k,cacheSizeInBytes:l,numberOfImagesCached:j.length}}function h(){for(;j.length>0;){var a=j.pop();delete i[a.imageId]}l=0}var i={},j=[],k=268435456,l=0;a.webGL.textureCache={putImageTexture:d,getImageTexture:e,removeImageTexture:f,setMaximumSizeBytes:b,getCacheInfo:g,purgeCache:h,cachedImages:j}}(cornerstone),function(a){"use strict";a.webGL||(a.webGL={}),a.webGL.vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"}(cornerstone);